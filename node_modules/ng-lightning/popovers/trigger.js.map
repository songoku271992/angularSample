{"version":3,"sources":["../../../temp/inline/popovers/trigger.ts"],"names":[],"mappings":"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","file":"trigger.js","sourceRoot":"","sourcesContent":["import {Directive, Input, ElementRef, ComponentRef, TemplateRef, ViewContainerRef,\n        Renderer2, ComponentFactoryResolver, Injector, EmbeddedViewRef, ComponentFactory,\n        Output, EventEmitter, NgZone} from '@angular/core';\nimport * as Tether from 'tether';\nimport 'rxjs/add/operator/take';\nimport {NglPopover, Direction} from './popover';\nimport {placement} from './placements';\nimport {toBoolean} from '../util/util';\n\n\nexport class NglPopoverTrigger {\n\n   nglPopover: string | TemplateRef<any>;\n\n   nglPopoverHeader: string;\n   nglPopoverFooter: string;\n\n   set nglPopoverPlacement(_placement: Direction) {\n    this.placement = _placement || 'top';\n    this.setTether();\n  }\n\n   set nglPopoverTheme(theme: string) {\n    this.theme = theme;\n    this.setPopover();\n  }\n\n   nglTooltip: string | boolean;\n\n   set nglPopoverDelay(delay: any | any[]) {\n    delay = Array.isArray(delay) ? delay : [delay, delay];\n    [this.openDelay, this.closeDelay] = delay.map(Number);\n  }\n\n   set nglInteractive(interactive: boolean | string) {\n    this.interactive = toBoolean(interactive);\n  }\n  get nglInteractive() {\n    return this.interactive;\n  }\n\n   set nglOpen(open: boolean) {\n    this.toggle(open, open ? this.openDelay : this.closeDelay);\n  }\n\n  // Emit an event when actual popover is shown or hidden\n   nglPopoverToggled = new EventEmitter<boolean>();\n\n  private popover: NglPopover;\n  private popoverFactory: ComponentFactory<NglPopover>;\n  private componentRef: ComponentRef<NglPopover>;\n  private viewRef: EmbeddedViewRef<any>;\n  private placement: Direction = 'top';\n  private theme: string;\n  private tether: Tether;\n  private openDelay = 0;\n  private closeDelay = 0;\n  private toggleTimeout: any = null;\n  private interactive = false;\n  private interactiveSubscription: any = null;\n\n  constructor(private element: ElementRef, private viewContainer: ViewContainerRef, private injector: Injector,\n              private ngZone: NgZone,\n              private renderer: Renderer2, componentFactoryResolver: ComponentFactoryResolver) {\n    this.popoverFactory = componentFactoryResolver.resolveComponentFactory(NglPopover);\n  }\n\n  // Expose open method\n  open(delay = this.openDelay) {\n    this.toggle(true, delay);\n  }\n\n  // Expose close method\n  close(delay = this.closeDelay) {\n    this.toggle(false, delay);\n  }\n\n  position(async = true) {\n    this.ngZone.runOutsideAngular(() => {\n      if (async) {\n        setTimeout(() => this.tether.position());\n      } else {\n        this.tether.position();\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.destroy();\n  }\n\n  private toggle(open: boolean, delay: number) {\n    if (this.toggleTimeout) {\n      clearTimeout(this.toggleTimeout);\n      this.toggleTimeout = null;\n    }\n\n    const toggleFn = (open ? this.create : this.destroy).bind(this);\n\n    if (delay > 0) {\n      this.toggleTimeout = setTimeout(() => {\n        this.toggleTimeout = null;\n        toggleFn();\n      }, delay);\n    } else {\n      toggleFn();\n    }\n  }\n\n  private setTether(create = false) {\n    if (!this.tether && !create) return;\n\n    const { attachment, targetAttachment, offset } = placement(this.placement);\n    const options = {\n      element: this.popover.element.nativeElement,\n      target: this.element.nativeElement,\n      attachment,\n      targetAttachment,\n      offset,\n    };\n\n    if (create) {\n      this.tether = new Tether(options);\n    } else {\n      this.tether.setOptions(options);\n    }\n\n    this.setPopover();\n  }\n\n  private setPopover() {\n    if (!this.popover) return;\n\n    const { opposite } = placement(this.placement);\n    this.popover.nubbin = opposite;\n    this.popover.theme = this.theme;\n    this.popover.nglTooltip = this.nglTooltip;\n  }\n\n  private create() {\n    if (this.componentRef) return;\n\n    const { nodes, viewRef } = this.getProjectableNodes();\n    this.viewRef = viewRef;\n\n    this.componentRef = this.viewContainer.createComponent(this.popoverFactory, 0, this.injector, [nodes]);\n    this.popover = this.componentRef.instance;\n    this.popover.header = this.nglPopoverHeader;\n    this.popover.footer = this.nglPopoverFooter;\n    this.popover.afterViewInit.take(1).subscribe(() => this.position(false));\n\n    if (this.nglInteractive) {\n      this.interactiveSubscription = this.popover.onInteraction.subscribe((enter: boolean) => this.nglOpen = enter);\n    }\n\n    this.setTether(true);\n\n    // To avoid unexpected behavior when template \"lives\" inside an OnPush\n    // component, explicitlly request change detection to run on creation.\n    this.popover.changeDetector.markForCheck();\n\n    this.nglPopoverToggled.emit(true);\n  }\n\n  private getProjectableNodes(): { nodes: any[], viewRef?: EmbeddedViewRef<any> } {\n    if (this.nglPopover instanceof TemplateRef) {\n      const viewRef: EmbeddedViewRef<any> = this.viewContainer.createEmbeddedView(<TemplateRef<any>>this.nglPopover);\n      return { nodes: viewRef.rootNodes, viewRef };\n    } else {\n      return { nodes: [this.renderer.createText(<string>this.nglPopover)] };\n    }\n  }\n\n  private destroy() {\n    if (!this.componentRef) return;\n\n    this.tether.destroy();\n    this.tether = null;\n\n    // Cleanup template view\n    if (this.viewRef) {\n      this.viewContainer.remove(this.viewContainer.indexOf(this.viewRef));\n      this.viewRef = null;\n    }\n\n    this.viewContainer.remove(this.viewContainer.indexOf(this.componentRef.hostView));\n    this.componentRef.destroy();\n    this.componentRef = null;\n    this.popover = null;\n\n    if (this.interactiveSubscription) {\n      this.interactiveSubscription.unsubscribe();\n    }\n\n    this.nglPopoverToggled.emit(false);\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{\n  selector: '[nglPopover]',\n  exportAs: 'nglPopover',\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n{type: ViewContainerRef, },\n{type: Injector, },\n{type: NgZone, },\n{type: Renderer2, },\n{type: ComponentFactoryResolver, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'nglPopover': [{ type: Input },],\n'nglPopoverHeader': [{ type: Input },],\n'nglPopoverFooter': [{ type: Input },],\n'nglPopoverPlacement': [{ type: Input },],\n'nglPopoverTheme': [{ type: Input },],\n'nglTooltip': [{ type: Input },],\n'nglPopoverDelay': [{ type: Input },],\n'nglInteractive': [{ type: Input },],\n'nglOpen': [{ type: Input },],\n'nglPopoverToggled': [{ type: Output },],\n};\n};\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}